"0",""
"0","#### which countries peaked in total GHG emissions for more than 10 years?"
"0",""
"0","## gather data"
"0",""
"0","data_peaking <- edgar_ghg %>% "
"0","  group_by(iso,country,year) %>% "
"0","  summarise_at(vars(CO2,CH4,N2O,Fgas,GHG),sum,na.rm=TRUE)"
"0",""
"0","## join population and GDP data"
"0",""
"0","data_peaking <- left_join(data_peaking,data_wdi_pop %>% select(-country),by=c(""iso"",""year""))"
"0",""
"0","## filter to countries above 1m population"
"0",""
"0","data_peaking <- data_peaking %>% "
"0","  group_by(country) %>% "
"0","  mutate(include=ifelse(max(population)>1e6,1,0)) %>% "
"0","  ungroup() %>% "
"0","  filter(include==1) %>% "
"0","  select(-include)"
"0",""
"0",""
"0","## find peak year CO2, excluding years after 2012"
"0",""
"0","peak_years_CO2 <- data_peaking %>% "
"0","  filter(year<2012) %>% "
"0","  group_by(country) %>% "
"0","  summarise(peak_year_CO2=year[which.max(CO2)])"
"0",""
"0","## find peak year GHG, excluding years after 2012"
"0",""
"0","peak_years_GHG <- data_peaking %>% "
"0","  filter(year<2012) %>% "
"0","  group_by(country) %>% "
"0","  summarise(peak_year_GHG=year[which.max(GHG)])"
"0",""
"0","peak_years <- left_join(peak_years_CO2,peak_years_GHG,by = ""country"")"
"0","peak_years <- peak_years %>% "
"0","  select(country,peak_year=peak_year_CO2)"
"0",""
"0","data_peaking <- left_join(data_peaking,peak_years,by = ""country"")"
"0",""
"0",""
"0","## calculate CO2 growth since peak year"
"0",""
"0","rates_CO2 <- data_peaking %>% filter(country==""nothing"") # create empty dataframe"
"0",""
"0","for (i in 1:length(unique(data_peaking$country))) {"
"0","  "
"0","  temp_data <- data_peaking %>% "
"0","    filter(country==unique(data_peaking$country)[i])"
"0","  "
"0","  temp_data <- temp_data %>% "
"0","    filter(year>=temp_data$peak_year[1])"
"0","  "
"0","  rates <- growth_rate(temp_data$year,temp_data$CO2)"
"0","  "
"0","  temp_data$rate_CO2_peak <- rates$rate"
"0","  temp_data$fit_CO2 <- rates$data$predicted_x"
"0","  temp_data$st_error <- rates$data$st_error"
"0","  "
"0","  rates_CO2 <- rbind(rates_CO2,temp_data)"
"0","}"
"0",""
"0","#rejoin with full data"
"0",""
"0","data_peaking <- left_join(data_peaking,rates_CO2 %>% select(country,year,rate_CO2_peak,fit_CO2),by = c(""country"", ""year""))"
"0",""
"0","data_peaking <- data_peaking %>% "
"0","  group_by(country) %>% "
"0","  mutate(rate_CO2_peak=na.locf(rate_CO2_peak,fromLast=TRUE))"
"0",""
"0",""
"0","## now do the same for GHG emissions"
"0",""
"0","rates_GHG <- data_peaking %>% "
"0","  filter(country==""nothing"") %>%  # create empty dataframe "
"0","  select(-fit_CO2,-rate_CO2_peak)"
"0",""
"0","for (i in 1:length(unique(data_peaking$country))) {"
"0","  "
"0","  temp_data <- data_peaking %>% "
"0","    filter(country==unique(data_peaking$country)[i])"
"0","  "
"0","  temp_data <- temp_data %>% "
"0","    filter(year>=temp_data$peak_year[1])"
"0","  "
"0","  rates <- growth_rate(temp_data$year,temp_data$GHG)"
"0","  "
"0","  temp_data$rate_GHG_peak <- rates$rate"
"0","  temp_data$fit_GHG <- rates$data$predicted_x"
"0","  temp_data$st_error <- rates$data$st_error"
"0","  "
"0","  rates_GHG <- rbind(rates_GHG,temp_data)"
"0","}"
"0",""
"0","#rejoin with full data"
"0",""
"0","data_peaking <- left_join(data_peaking,rates_GHG %>% select(country,year,rate_GHG_peak,fit_GHG),by = c(""country"", ""year""))"
"0",""
"0","data_peaking <- data_peaking %>% "
"0","  group_by(country) %>% "
"0","  mutate(rate_GHG_peak=na.locf(rate_GHG_peak,fromLast=TRUE))"
"0",""
"0",""
"0","## now calculate the last 10 years"
"0",""
"0","rates_GHG_2012 <- data_peaking %>% filter(country==""nothing"") # create empty dataframe"
"0",""
"0","for (i in 1:length(unique(data_peaking$country))) {"
"0","  "
"0","  temp_data <- data_peaking %>%"
"0","    filter(country==unique(data_peaking$country)[i]) %>% "
"0","    filter(year>2011)"
"0","  "
"0","  rates <- growth_rate(temp_data$year,temp_data$GHG)"
"0","  "
"0","  temp_data$rate_GHG_2012 <- rates$rate*100"
"0","  "
"0","  rates_GHG_2012 <- rbind(rates_GHG_2012,temp_data)"
"0","}"
"0",""
"0","data_peaking <- left_join(data_peaking,rates_GHG_2012 %>% filter(year==2021) %>% select(country,rate_GHG_2012),by = c(""country""))"
"0",""
"0",""
