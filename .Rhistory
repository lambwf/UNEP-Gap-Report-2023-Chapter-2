mutate(rel_change=round(rel_change,1))
data_table_trend$gas <- as.factor(data_table_trend$gas)
data_table_trend$gas <- fct_relevel(data_table_trend$gas,
"GHG","Fossil_CO2","LULUCF_CO2","CH4","N2O","Fgas")
data_table_trend <- spread(data_table_trend,year,value)
data_table_trend <- data_table_trend %>%
select(gas,`2021`,`2022`,abs_change,rel_change)
addWorksheet(wb2,"global_trend_2021_2022")
writeData(wb2, sheet = "global_trend_2021_2022", data_table_trend, colNames = T, rowNames = F)
####### trends in major emitters - latest year
data_table_country_trend <- country_trend %>%
filter(year %in% c(2021,2022)) %>%
mutate(value=GHG) %>%
group_by(iso,country)  %>%
mutate(abs_change=last(value)-first(value)) %>%
mutate(rel_change=abs_change/first(value)) %>%
mutate(abs_change=signif(abs_change,2)) %>%
mutate(rel_change=rel_change*100) %>%
mutate(rel_change=round(rel_change,1)) %>%
filter(high_emitters==1) %>%
select(iso,country,year,value,abs_change,rel_change)
data_table_country_trend <- spread(data_table_country_trend,year,value)
data_table_country_trend <- data_table_country_trend %>%
select(iso,country,`2021`,`2022`,abs_change,rel_change)
addWorksheet(wb2,"country_trend_2021_2022")
writeData(wb2, sheet = "country_trend_2021_2022", data_table_trend, colNames = T, rowNames = F)
analysis_decade_average <- rbind(gas_trend,gas_trend %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
group_by(year) %>%
summarise(value=sum(value)) %>%
mutate(gas="GHG"))
analysis_decade_average <- analysis_decade_average %>%
filter(year>=2010 & year<=2019) %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
group_by(gas) %>%
summarise(rel_change=growth_rate(year,value)$rate) %>%
mutate(rel_change=rel_change*100) %>%
mutate(rel_change=round(rel_change,1))
analysis_contributions <- country_trend %>%
filter(year==2021)
View(analysis_contributions)
analysis_contributions <- left_join(analysis_contributions,country_aggregations %>% select(-high_emitters),by="iso") %>%
mutate(G20=ifelse(iso=="EU27",1,G20))
analysis_contributions <- left_join(analysis_contributions,gas_trend %>%
filter(gas!="LULUCF_CO2") %>%
group_by(year) %>%
summarise(GHG_total_world=sum(value,na.rm=TRUE)),
by="year")
analysis_contributions <- analysis_contributions %>%
mutate(GHG_total_percentage=GHG_total/GHG_total_world) %>%
filter(iso!="WLD")
sum(analysis_contributions$GHG_total_percentage[analysis_contributions$high_emitters==1],na.rm=T)
sum(analysis_contributions$GHG_total[analysis_contributions$high_emitters==1],na.rm=T)
sum(analysis_contributions$GHG_total_percentage[analysis_contributions$G20==1],na.rm=T)
sum(analysis_contributions$GHG_total[analysis_contributions$G20==1],na.rm=T)
sum(analysis_contributions$GHG_total_percentage[analysis_contributions$LDC==1],na.rm=T)
sum(analysis_contributions$GHG_total[analysis_contributions$LDC==1],na.rm=T)
sum(analysis_contributions$GHG_total_percentage[analysis_contributions$SIDS==1],na.rm=T)
sum(analysis_contributions$GHG_total[analysis_contributions$SIDS==1],na.rm=T)
sum(analysis_contributions$GHG_total_percentage[analysis_contributions$high_emitters==1],na.rm=T)*100
sum(analysis_contributions$GHG_total[analysis_contributions$high_emitters==1],na.rm=T)
sum(analysis_contributions$GHG_total_percentage[analysis_contributions$G20==1],na.rm=T)*100
sum(analysis_contributions$GHG_total[analysis_contributions$G20==1],na.rm=T)
sum(analysis_contributions$GHG_total_percentage[analysis_contributions$LDC==1],na.rm=T)*100
sum(analysis_contributions$GHG_total[analysis_contributions$LDC==1],na.rm=T)
sum(analysis_contributions$GHG_total_percentage[analysis_contributions$SIDS==1],na.rm=T)*100
sum(analysis_contributions$GHG_total[analysis_contributions$SIDS==1],na.rm=T)
########## prepare two plots, with bookkeeping LUC and NGHGI LUC ##########
#### bookeeping LUC
## calculate the totals in each time period
gas_totals <- gas_trend %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
group_by(year) %>%
summarise(totals=sum(value))
line_data <- data.frame(x=c(1990,1990,2000,2000,2010,2010,2020,2020,2022,2022),y=c(0,60))
### get the growth rates between time periods
rates <- gas_trend %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
filter(year>=1991) %>%
group_by(year) %>%
summarise(value=sum(value)) %>%
mutate(total_rate=NA)
rates$decade <- list(rep(1:(nrow(rates) %/% 10 + 1), each = 10, len = nrow(rates)))[[1]]
#### little hack - not sure yet which time frames to calculate
rates <- rates %>% mutate(decade=ifelse(year>2020,3,decade))
rates$total_rate[rates$decade==1] = growth_rate(rates$year[rates$decade==1],rates$value[rates$decade==1])$rate
rates$total_rate[rates$decade==2] = growth_rate(rates$year[rates$decade==2],rates$value[rates$decade==2])$rate
rates$total_rate[rates$decade==3] = growth_rate(rates$year[rates$decade==3],rates$value[rates$decade==3])$rate
rates <- rates %>%
filter(year %in% c(1991,2001,2011))
rates <- rates %>%
mutate(total_rate=total_rate*100) %>%
mutate(total_rate=round(total_rate,1)) %>%
mutate(value=signif(value,2))
## plot
p1 <- gas_trend %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
#filter(year<=2020) %>%
ggplot(.,aes(x=year,y=value,fill=gas)) +
geom_area(colour="#737373") +
geom_line(inherit.aes = FALSE,data=line_data,aes(x=x,y=y,group=x),alpha=0.3,linetype="dashed") +
#### text with the rates
#geom_text(data=rates %>% filter(!is.na(total_rate)),inherit.aes = FALSE,
#                          aes(x=year+4,y=61,                                label=paste0("+",round(total_rate,1),"%/yr")),size=3.5,colour="#252525") +
#### text with the totals
geom_text(inherit.aes = FALSE, data=gas_totals %>% filter(year %in% c(1990,2000,2010,2020,2022)),aes(x=ifelse(year==2022,year+0.5,year),y=63,label=paste(signif(totals,3),"Gt")),
size=3.5,colour="#252525") +
#ylab(bquote("Greenhouse gas emissions (Gt" ~CO[2]* "eq/yr)")) +
scale_y_continuous(breaks=c(0,10,20,30,40,50,60),limits=c(-2,64)) +
scale_x_continuous(breaks=c(1990,2000,2010,2020,2022)) +
scale_fill_manual(values=c("#e78ac3","#fc8d62","#8da0cb","#66c2a5","#a6d854")) +
theme_wl() +
#ylab("Gt" ~CO[2]* "eq/yr") +
theme(
legend.position="none",
axis.title = element_blank()) +
labs(title=bquote(bold("Total greenhouse gas emissions 1990-2022")),
subtitle=bquote("Gt" ~CO[2]* "e"))
#### Comparison plot of GCB and NGHGI
gas_comparison <- gas_trend %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
filter(year==2021) %>%
rename(GCB=value) %>%
mutate(gas=as.character(gas))
gas_comparison <- left_join(gas_comparison,gas_trend %>%
filter(gas!="LULUCF_CO2") %>%
filter(year==2021) %>%
rename(NGHGI=value) %>%
mutate(gas=as.character(gas)) %>%
mutate(gas=ifelse(gas=="LULUCF_CO2_NGHGI","LULUCF_CO2",gas)),
by=c("year","gas"))
gas_comparison <- gather(gas_comparison,var,value,-year,-gas)
gas_comparison$gas <- as.factor(gas_comparison$gas)
gas_comparison$gas <- fct_relevel(gas_comparison$gas,
"LULUCF_CO2",
"Fgas",
"N2O",
"CH4",
"Fossil_CO2")
p2 <- gas_comparison %>%
ggplot(.,aes(x=var,y=value,fill=gas)) +
geom_col(colour="#737373",width=0.45) +
coord_flip() +
#### text with the totals
geom_text(inherit.aes = FALSE, data=gas_comparison %>% group_by(var) %>% summarise(value=sum(value)),aes(x=var,y=61,label=paste(signif(value,3),"Gt")),        size=3.5,colour="#252525") +
scale_y_continuous(breaks=c(0,10,20,30,40,50,60),limits=c(-5,64)) +
scale_x_discrete(labels=c("GHG emissions +\nbookkeeping LULUCF","GHG emissions +\ninventory LULUCF")) +
scale_fill_manual(values=c("#e78ac3","#fc8d62","#8da0cb","#66c2a5","#a6d854"),
labels=c("LULUCF CO2","F-gases","N2O","CH4","Fossil CO2"),
guide = guide_legend(reverse = TRUE)) +
theme_wl() +
theme(legend.position="bottom",
legend.title=element_blank(),
axis.title = element_blank(),
#axis.text.y = element_blank(),
#axis.ticks.y = element_blank()
#axis.text.x = element_text(angle = 45,hjust=1)
) +
#guides(fill=guide_legend(nrow=2,byrow=TRUE)) +
labs(title=bquote(bold("Comparison of estimates in 2021")),
subtitle=bquote("Gt" ~CO[2]* "e"))
#figure_gases <- p1 / (p2 + plot_spacer() + plot_layout(widths=c(6,1)))
figure_gases <- p1 / wrap_elements(p2) + plot_layout(heights=c(4,3.5))
figure_gases
addWorksheet(wb,"fig_1_gases_trend")
addWorksheet(wb,"fig_1_gases_comparison")
writeData(wb, sheet = "fig_1_gases_trend", gas_trend %>% filter(gas!="CO2_LULUCF_NGHGI"), colNames = T, rowNames = F)
writeData(wb, sheet = "fig_1_gases_comparison", gas_comparison, colNames = T, rowNames = F)
View(gas_trend)
country_trend <- country_trend %>% filter(year>=2000)
country_trend <- country_trend %>% filter(year>=2000)
library(ggpattern)
## plot
country_bar_total <- gather(country_trend %>%
filter(high_emitters==1) %>%
filter(iso!="WLD") %>%
ungroup() %>%
filter(year==2021) %>%
select(country,GHG,LULUCF_CO2,GHG_total,gross_ghg_difference),
var,value,-country,-GHG_total,-gross_ghg_difference)
p1 <- country_bar_total %>%
ggplot(.,aes(x=reorder(country,GHG_total),y=value,fill=country,pattern=var)) +
geom_bar_pattern(stat='identity',
width=0.6,
colour="#737373",
pattern_fill = "black",
pattern_angle = 45,
pattern_density = 0.1,
pattern_spacing = 0.025,
pattern_key_scale_factor = 0.6) +
geom_text(data=country_bar_total %>% filter(var=="GHG"),inherit.aes = FALSE,size=3.5,color="#737373",
aes(x=reorder(country,GHG_total),y=ifelse(GHG_total>value,GHG_total+0.5,value+0.5),label=round(GHG_total,1)),
hjust=0) +
coord_flip() +
scale_y_continuous(expand = expand_scale(add=c(1,2.25))) +
scale_fill_brewer(palette = "Set2",guide = 'none') +
scale_size_discrete(range=c(2,2),labels="NET GHG emissions") +
scale_pattern_manual(values = c(LULUCF_CO2 = "stripe", GHG = "none"),
labels=c("Fossil CO2, CH4, N2O, F-gases","LULUCF CO2")) +
annotate(geom = 'text', label = 'Year: 2021',
x = -Inf, y = Inf, hjust = 1.05, vjust = -0.3,size=3.5,color="#737373") +
theme_wl() +
theme(legend.position = c(0.65,0.25),
legend.title = element_blank(),
legend.background = element_blank(),
axis.title = element_blank(),
plot.background = element_blank())  +
guides(pattern = guide_legend(override.aes = list(fill = "white"))) +
labs(title=bquote(bold("GHG emissions in 2021 and trend since 2000")),
subtitle=bquote("Gt" ~CO[2]* "e"))
p2 <- country_trend %>%
filter(iso!="WLD") %>%
filter(high_emitters==1) %>%
filter(year<2022) %>%
filter(year>=2000) %>%
ggplot(.,aes(x=year,y=GHG_total,color=country)) +
geom_line(size=1)+
scale_x_continuous(breaks=c(2000,2010,2020,2022),expand = expand_scale(add=c(0,0))) +
scale_y_continuous(expand = c(0, NA), limits = c(0, 15)) +
scale_color_brewer(palette = "Set2") +
theme_wl() +
theme(legend.position="none",
axis.title = element_blank(),
plot.background = element_blank())
p3 <- country_trend %>%
filter(iso!="AIRSEA") %>%
filter(high_emitters==1) %>%
filter(year==2021) %>%
ggplot(.,aes(x=reorder(country,GHG_total_pc),y=GHG_total_pc,fill=country,label=round(GHG_total_pc,1))) +
geom_bar(stat='identity',colour="#737373",width=0.65) +
geom_text(aes(y=GHG_total_pc+0.5),size=3.5,color="#737373",hjust=0) +
scale_y_continuous(expand = expand_scale(add=c(1,2.25))) +
coord_flip() +
scale_fill_brewer(palette = "Set2") +
annotate(geom = 'text', label = 'Year: 2021',
x = -Inf, y = Inf, hjust = 1.05, vjust = -0.3,size=3.5,color="#737373") +
theme_wl() +
theme(legend.position="none",
axis.title = element_blank(),
plot.background = element_blank()) +
labs(title=bquote(bold("Per capita GHG emissions in 2021 and trend since 2000")),
subtitle=bquote("t" ~CO[2]* "e" /capita))
p4 <- country_trend %>%
filter(iso!="AIRSEA") %>%
filter(high_emitters==1) %>%
filter(year<2022) %>%
filter(year>=2000) %>%
ggplot(.,aes(x=year,y=GHG_total_pc,color=country)) +
geom_line(size=1)+
#geom_line(aes(x=year,y=ghg/(population/1e9),color=country),linetype="dashed",size=1,alpha=0.4)+
scale_x_continuous(breaks=c(2000,2010,2020),expand = expand_scale(add=c(0,0))) +
scale_y_continuous(expand = c(0, NA), limits = c(0, 27)) +
scale_color_brewer(palette = "Set2") +
theme_wl() +
theme(legend.position="none",
axis.title = element_blank(),
plot.background = element_blank())
figure_countries <- p1 + p2 + p3 + p4 +plot_layout(ncol=2,widths=c(2.2,2))
figure_countries
addWorksheet(wb,"fig_2_countries_total")
addWorksheet(wb,"fig_2_countries_total_trend")
addWorksheet(wb,"fig_2_countries_per_cap")
addWorksheet(wb,"fig_2_countries_per_cap_trend")
writeData(wb, sheet = "fig_2_countries_total", country_bar_total %>%
select(country,var,value), colNames = T, rowNames = F)
writeData(wb, sheet = "fig_2_countries_total_trend", country_trend %>%
filter(iso!="WLD") %>%
filter(high_emitters==1) %>%
filter(year<2022) %>%
select(country,year,GHG_total), colNames = T, rowNames = F)
writeData(wb, sheet = "fig_2_countries_per_cap", country_trend %>%
filter(iso!="AIRSEA") %>%
filter(high_emitters==1) %>%
filter(year==2021) %>%
select(country,GHG_total_pc), colNames = T, rowNames = F)
writeData(wb, sheet = "fig_2_countries_per_cap_trend", country_trend %>%
filter(iso!="AIRSEA") %>%
filter(high_emitters==1) %>%
filter(year<2022) %>%
select(country,year,GHG_total_pc), colNames = T, rowNames = F)
wb2 <- createWorkbook()
data_table_levels <- gas_trend %>%
filter(year>=2010 & year <=2019) %>%
group_by(gas) %>%
summarise(value=mean(value,na.rm=TRUE)) %>%
mutate(year="2010-2019")
data_table_levels <- rbind(data_table_levels,gas_trend %>%
filter(year>=2020) %>%
mutate(year=as.character(year)))
## calculate uncertainties
uncertainties = data.frame(gas=c("Fossil_CO2","LULUCF_CO2","LULUCF_CO2_NGHGI","CH4","N2O","Fgas"),uncertainty=c(0.08,0.7,0.7,0.3,0.6,0.3))
data_table_levels <- left_join(data_table_levels,uncertainties,by="gas") %>%
mutate(uncertainty_abs=value*uncertainty)
data_table_levels_ghg <- data_table_levels
data_table_levels <- data_table_levels %>%
mutate(value=signif(value,3)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,3)) %>%
mutate(value=paste0(value,"±",uncertainty_abs))
View(data_table_levels)
data_table_levels_ghg <- data_table_levels_ghg %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
wb2 <- createWorkbook()
data_table_levels <- gas_trend %>%
filter(year>=2010 & year <=2019) %>%
group_by(gas) %>%
summarise(value=mean(value,na.rm=TRUE)) %>%
mutate(year="2010-2019")
data_table_levels <- rbind(data_table_levels,gas_trend %>%
filter(year>=2020) %>%
mutate(year=as.character(year)))
## calculate uncertainties
uncertainties = data.frame(gas=c("Fossil_CO2","LULUCF_CO2","LULUCF_CO2_NGHGI","CH4","N2O","Fgas"),uncertainty=c(0.08,0.7,0.7,0.3,0.6,0.3))
data_table_levels <- left_join(data_table_levels,uncertainties,by="gas") %>%
mutate(uncertainty_abs=value*uncertainty)
data_table_levels_ghg <- data_table_levels
data_table_levels <- data_table_levels %>%
mutate(value=signif(value,3)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,3)) %>%
mutate(value=paste0(value,"±",uncertainty_abs))
## calculate total GHG
data_table_levels_ghg <- data_table_levels_ghg %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
data_table_levels_ghg <- data_table_levels_ghg %>%
mutate(value=signif(value,3)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,3)) %>%
mutate(value=paste0(value,"±",uncertainty_abs)) %>%
mutate(gas="GHG")
data_table_levels <- rbind(data_table_levels %>% select(gas,value,year),data_table_levels_ghg %>% select(gas,value,year))
data_table_levels$gas <- as.factor(data_table_levels$gas)
data_table_levels$gas <- fct_relevel(data_table_levels$gas,
"GHG","Fossil_CO2","LULUCF_CO2","LULUCF_CO2_NGHGI","CH4","N2O","Fgas")
data_table_levels <- spread(data_table_levels,year,value)
addWorksheet(wb2,"table_1")
writeData(wb2, sheet = "table_1", data_table_levels, colNames = T, rowNames = F)
####### trends in gases - latest year
data_table_trend <- rbind(gas_trend,gas_trend %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
group_by(year) %>%
summarise(value=sum(value)) %>%
mutate(gas="GHG"))
data_table_trend <- data_table_trend %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
filter(year %in% c(2021,2022)) %>%
group_by(gas) %>%
mutate(abs_change=last(value)-first(value)) %>%
mutate(rel_change=abs_change/first(value)) %>%
mutate(abs_change=signif(abs_change,2)) %>%
mutate(rel_change=rel_change*100) %>%
mutate(rel_change=round(rel_change,1))
data_table_trend$gas <- as.factor(data_table_trend$gas)
data_table_trend$gas <- fct_relevel(data_table_trend$gas,
"GHG","Fossil_CO2","LULUCF_CO2","CH4","N2O","Fgas")
data_table_trend <- spread(data_table_trend,year,value)
data_table_trend <- data_table_trend %>%
select(gas,`2021`,`2022`,abs_change,rel_change)
addWorksheet(wb2,"global_trend_2021_2022")
writeData(wb2, sheet = "global_trend_2021_2022", data_table_trend, colNames = T, rowNames = F)
####### trends in major emitters - latest year
data_table_country_trend <- country_trend %>%
filter(year %in% c(2021,2022)) %>%
mutate(value=GHG) %>%
group_by(iso,country)  %>%
mutate(abs_change=last(value)-first(value)) %>%
mutate(rel_change=abs_change/first(value)) %>%
mutate(abs_change=signif(abs_change,2)) %>%
mutate(rel_change=rel_change*100) %>%
mutate(rel_change=round(rel_change,1)) %>%
filter(high_emitters==1) %>%
select(iso,country,year,value,abs_change,rel_change)
data_table_country_trend <- spread(data_table_country_trend,year,value)
data_table_country_trend <- data_table_country_trend %>%
select(iso,country,`2021`,`2022`,abs_change,rel_change)
addWorksheet(wb2,"country_trend_2021_2022")
writeData(wb2, sheet = "country_trend_2021_2022", data_table_trend, colNames = T, rowNames = F)
View(data_table_trend)
wb2 <- createWorkbook()
data_table_levels <- gas_trend %>%
filter(year>=2010 & year <=2019) %>%
group_by(gas) %>%
summarise(value=mean(value,na.rm=TRUE)) %>%
mutate(year="2010-2019")
data_table_levels <- rbind(data_table_levels,gas_trend %>%
filter(year>=2020) %>%
mutate(year=as.character(year)))
## calculate uncertainties
uncertainties = data.frame(gas=c("Fossil_CO2","LULUCF_CO2","LULUCF_CO2_NGHGI","CH4","N2O","Fgas"),uncertainty=c(0.08,0.7,0.7,0.3,0.6,0.3))
data_table_levels <- left_join(data_table_levels,uncertainties,by="gas") %>%
mutate(uncertainty_abs=value*uncertainty)
data_table_levels_ghg <- data_table_levels
data_table_levels <- data_table_levels %>%
mutate(value=signif(value,3)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,3)) %>%
mutate(value=paste0(value,"±",uncertainty_abs))
## calculate total GHG
data_table_levels_ghg <- data_table_levels_ghg %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
data_table_levels_ghg <- data_table_levels_ghg %>%
mutate(value=signif(value,3)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,3)) %>%
mutate(value=paste0(value,"±",uncertainty_abs)) %>%
mutate(gas="GHG")
data_table_levels <- rbind(data_table_levels %>% select(gas,value,year),data_table_levels_ghg %>% select(gas,value,year))
data_table_levels$gas <- as.factor(data_table_levels$gas)
data_table_levels$gas <- fct_relevel(data_table_levels$gas,
"GHG","Fossil_CO2","LULUCF_CO2","LULUCF_CO2_NGHGI","CH4","N2O","Fgas")
data_table_levels <- spread(data_table_levels,year,value)
addWorksheet(wb2,"table_1")
writeData(wb2, sheet = "table_1", data_table_levels, colNames = T, rowNames = F)
####### trends in gases - latest year
data_table_trend <- rbind(gas_trend,gas_trend %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
group_by(year) %>%
summarise(value=sum(value)) %>%
mutate(gas="GHG"))
data_table_trend <- data_table_trend %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
filter(year %in% c(2021,2022)) %>%
group_by(gas) %>%
mutate(abs_change=last(value)-first(value)) %>%
mutate(rel_change=abs_change/first(value)) %>%
mutate(abs_change=signif(abs_change,3)) %>%
mutate(rel_change=rel_change*100) %>%
mutate(rel_change=round(rel_change,1))
data_table_trend$gas <- as.factor(data_table_trend$gas)
data_table_trend$gas <- fct_relevel(data_table_trend$gas,
"GHG","Fossil_CO2","LULUCF_CO2","CH4","N2O","Fgas")
data_table_trend <- spread(data_table_trend,year,value)
data_table_trend <- data_table_trend %>%
select(gas,`2021`,`2022`,abs_change,rel_change)
addWorksheet(wb2,"global_trend_2021_2022")
writeData(wb2, sheet = "global_trend_2021_2022", data_table_trend, colNames = T, rowNames = F)
####### trends in major emitters - latest year
data_table_country_trend <- country_trend %>%
filter(year %in% c(2021,2022)) %>%
mutate(value=GHG) %>%
group_by(iso,country)  %>%
mutate(abs_change=last(value)-first(value)) %>%
mutate(rel_change=abs_change/first(value)) %>%
mutate(abs_change=signif(abs_change,3)) %>%
mutate(rel_change=rel_change*100) %>%
mutate(rel_change=round(rel_change,1)) %>%
filter(high_emitters==1) %>%
select(iso,country,year,value,abs_change,rel_change)
data_table_country_trend <- spread(data_table_country_trend,year,value)
data_table_country_trend <- data_table_country_trend %>%
select(iso,country,`2021`,`2022`,abs_change,rel_change)
addWorksheet(wb2,"country_trend_2021_2022")
writeData(wb2, sheet = "country_trend_2021_2022", data_table_country_trend, colNames = T, rowNames = F)
saveWorkbook(wb2,paste0("Results/UNEP-Gap-Report-2023-Chapter-2-Chapter-Data.xlsx"),overwrite=T)
View(gas_totals)
wb2 <- createWorkbook()
data_table_levels <- gas_trend %>%
filter(year>=2010 & year <=2019) %>%
group_by(gas) %>%
summarise(value=mean(value,na.rm=TRUE)) %>%
mutate(year="2010-2019")
data_table_levels <- rbind(data_table_levels,gas_trend %>%
filter(year>=2020) %>%
mutate(year=as.character(year)))
## calculate uncertainties
uncertainties = data.frame(gas=c("Fossil_CO2","LULUCF_CO2","LULUCF_CO2_NGHGI","CH4","N2O","Fgas"),uncertainty=c(0.08,0.7,0.7,0.3,0.6,0.3))
data_table_levels <- left_join(data_table_levels,uncertainties,by="gas") %>%
mutate(uncertainty_abs=value*uncertainty)
data_table_levels_ghg <- data_table_levels
data_table_levels <- data_table_levels %>%
mutate(value=signif(value,3)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,3)) %>%
mutate(value=paste0(value,"±",uncertainty_abs))
View(data_table_levels)
wb2 <- createWorkbook()
data_table_levels <- gas_trend %>%
filter(year>=2010 & year <=2019) %>%
group_by(gas) %>%
summarise(value=mean(value,na.rm=TRUE)) %>%
mutate(year="2010-2019")
data_table_levels <- rbind(data_table_levels,gas_trend %>%
filter(year>=2019) %>%
mutate(year=as.character(year)))
## calculate uncertainties
uncertainties = data.frame(gas=c("Fossil_CO2","LULUCF_CO2","LULUCF_CO2_NGHGI","CH4","N2O","Fgas"),uncertainty=c(0.08,0.7,0.7,0.3,0.6,0.3))
data_table_levels <- left_join(data_table_levels,uncertainties,by="gas") %>%
mutate(uncertainty_abs=value*uncertainty)
data_table_levels_ghg <- data_table_levels
data_table_levels <- data_table_levels %>%
mutate(value=signif(value,3)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,3)) %>%
mutate(value=paste0(value,"±",uncertainty_abs))
## calculate total GHG
data_table_levels_ghg <- data_table_levels_ghg %>%
filter(gas!="LULUCF_CO2_NGHGI") %>%
mutate(uncertainty_abs=uncertainty_abs^2) %>%
group_by(year) %>%
summarise(value=sum(value,na.rm=TRUE),
uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))
data_table_levels_ghg <- data_table_levels_ghg %>%
mutate(value=signif(value,3)) %>%
mutate(uncertainty_abs=signif(uncertainty_abs,3)) %>%
mutate(value=paste0(value,"±",uncertainty_abs)) %>%
mutate(gas="GHG")
data_table_levels <- rbind(data_table_levels %>% select(gas,value,year),data_table_levels_ghg %>% select(gas,value,year))
